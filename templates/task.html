<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <title>Task Game - MemoQuest</title>
        <link href="https://fonts.googleapis.com/css?family=Montserrat:900,700" rel="stylesheet">
        <link rel="stylesheet" href="{{ url_for('static', filename='css/admin_game_constraints.css') }}">
        <style>
                .drawer {
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 85vw;
                    max-width: 420px;
                    height: 100vh;
                    background: #d6af41;
                    box-shadow: 2px 0 16px #0002;
                    z-index: 99999;
                    transform: translateX(-100%);
                    transition: transform 0.25s cubic-bezier(.4,0,.2,1);
                    display: flex;
                    flex-direction: column;
                    border-top-right-radius: 2.2em;
                    outline: none;
                }
                .drawer.open {
                    transform: translateX(0);
                }
                .drawer-header {
                    display: flex;
                    align-items: center;
                    justify-content: space-between;
                    padding: 1.2em 1.2em 0.5em 1.2em;
                }
                .drawer-title {
                    font-size: 1.3em;
                    font-weight: 900;
                    color: #1a232b;
                    letter-spacing: 2px;
                    text-transform: uppercase;
                }
                .drawer-close {
                    background: none;
                    border: 2px solid #1a232b;
                    font-size: 2em;
                    color: #1a232b;
                    cursor: pointer;
                    border-radius: 0.7em;
                    padding: 0.1em 0.3em;
                    margin-left: 1em;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    background: #f6e4cb;
                }
                .drawer-content {
                    padding: 0 1.2em 1.2em 1.2em;
                    flex: 1;
                    overflow-y: auto;
                }
                .drawer-section-title {
                    font-size: 1.25em;
                    font-weight: 900;
                    color: #1a232b;
                    margin: 1.2em 0 0.7em 0;
                    letter-spacing: 1px;
                    text-transform: uppercase;
                }
                .team-details {
                    margin-bottom: 1.2em;
                }
                .team-arrow-box {
                    background: #f6e4cb;
                    border-radius: 0 2em 2em 0;
                    padding: 1.2em 1.2em 1.2em 2.5em;
                    margin-left: -1.5em;
                    font-size: 1.1em;
                    font-weight: 900;
                    color: #1a232b;
                    display: flex;
                    flex-direction: column;
                    gap: 0.7em;
                    position: relative;
                    min-width: 70%;
                    box-shadow: 0 2px 8px #0001;
                }
                .drawer-overlay {
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100vw;
                    height: 100vh;
                    background: rgba(0,0,0,0.18);
                    z-index: 99998;
                    display: none;
                }
                .drawer-overlay.open {
                    display: block;
                }
                .hamburger {
                    width: 2.6em;
                    height: 2.6em;
                    display: flex;
                    flex-direction: column;
                    justify-content: center;
                    align-items: center;
                    background: #fff;
                    border: none;
                    border-radius: 8px;
                    box-shadow: 0 2px 8px #0001;
                    cursor: pointer;
                    padding: 0.4em;
                    margin-right: 0.4em;
                }
                .hamburger span {
                    display: block;
                    width: 1.8em;
                    height: 0.32em;
                    background: #1a232b;
                    border-radius: 2px;
                    margin: 0.19em 0;
                    transition: all 0.2s;
                }
        </style>
        <script src="{{ url_for('static', filename='js/loading.js') }}"></script>
        <script>
                // Expose team_num from session to JS
                window.teamNum = "{{ session.get('team_num', '') }}";
        </script>
        <script src="{{ url_for('static', filename='js/task_drawer.js') }}"></script>
</head>
<body>
        <div class="header-bar">
                <button class="hamburger" id="hamburgerBtn" aria-label="Open menu" aria-controls="drawerMenu" aria-expanded="false" onclick="openDrawer()">
                        <span></span>
                        <span></span>
                        <span></span>
                </button>
                <div class="avatar" onclick="window.location.href='/profile'" title="Profile"></div>
        </div>
        <nav class="drawer" id="drawerMenu" aria-hidden="true" tabindex="-1">
            <div class="drawer-header">
                <span class="drawer-title">MEMOQUEST</span>
                <button class="drawer-close" aria-label="Close menu" onclick="closeDrawer()">&rarr;</button>
            </div>
            <div class="drawer-content">
                <div class="drawer-section-title">TEAM DEATILS :</div>
                <div class="team-details">
                    <div class="team-arrow-box">
                        <div><b>TEAM NUMBER:</b> {{ user.team_num if user else '' }}</div>
                        <div><b>SCORE :</b> {{ user.score if user else '' }}</div>
                        <div><b>POSITION :</b> {{ user.position if user and user.position is not none else '' }}</div>
                    </div>
                </div>
                <div class="drawer-section-title" style="margin-top:2em;">LEADERBOARD</div>
                {% for entry in leaderboard %}
                <div class="leaderboard-entry">
                    <div class="leaderboard-arrow-box">
                        <div><b>TEAM NO :</b> {{ entry.team_num }}</div>
                        <div><b>SCORE :</b> {{ entry.score }}</div>
                    </div>
                    <div class="medal medal-{{ loop.index }}">{{ loop.index }}</div>
                </div>
                {% endfor %}
            </div>
        </nav>
        <div class="drawer-overlay" id="drawerOverlay" onclick="closeDrawer()"></div>
        <div id="task-game-section" style="max-width:480px;margin:2em auto 2em auto;padding:1.5em 1em;background:#fffbe6;border-radius:1.5em;box-shadow:0 2px 16px #d6af4133;">
                <h2 style="text-align:center;font-size:1.5em;font-weight:900;color:#d6af41;margin-bottom:1em;">Task Game</h2>
                <div id="task-content" style="margin-top:2em;">
                        <p>Complete the following task:</p>
                        <ul style="text-align:left; margin: 0 auto; max-width: 90%;">
                                <li>Take a group selfie with your team and upload it in the gallery.</li>
                                <li>Find a hidden object in the admin's room and bring it to the admin desk.</li>
                                <li>Record a 10-second video of your team doing a fun pose and upload it in the gallery.</li>
                        </ul>
                </div>
            <button class="game-submit-btn" style="margin-top:2em;" id="finish-task-btn">Finish</button>
            <script>
            document.addEventListener('DOMContentLoaded', function() {
                document.getElementById('finish-task-btn').onclick = function() {
                    let teamNum = window.teamNum || null;
                    if (!teamNum) {
                        alert('Team number not found in session.');
                        return;
                    }
                    fetch('/submit-level3-score', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ team_num: teamNum, score: 1 })
                    })
                    .then(res => res.json())
                    .then(data => {
                        if (data.success) {
                            window.location.href = '/home';
                        } else {
                            alert('Error: ' + (data.error || 'Could not submit score.'));
                        }
                    })
                    .catch(() => {
                        alert('Network error.');
                    });
                };
            });
            </script>
        </div>
</body>
</html>
